<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CIFRA | CIFRAEZ</title>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="shortcut icon" href="../fotos_usadas/logocifraez.jpg" type="image/x-icon" />
    
  </head>

  <body>
    <header>
      <div class="header">
        <div class="logo_pagina">
          <h1>
            <a href="../index.html">CIFRAEZ</a>
          </h1>
        </div>
        <input
          type="text"
          id="ipt_pesquisa"
          placeholder="Buscar..."
          onkeyup="handleKeyUp(event)"
        />
        <div class="navbar">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            fill="currentColor"
            class="bi bi-person-circle"
            viewBox="0 0 16 16"
          >
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
            <path
              fill-rule="evenodd"
              d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
            />
          </svg>
        </div>
      </div>
    </header>

    <!-- tela_cifra -->
    <div class="tela_inteira_cifra escondido" id="musica_selecionada"></div>
    <div class="escondido range_valor" id="range">
      Auto rolagem
      <input
        type="range"
        min="0"
        max="1000"
        step="10"
        value="0"
        id="rolar"
        class="range"
        onclick="correr_pagina()"
      />

      <div class="svg-btn" onclick="parar_rolagem()">
        <svg
          class="fechar"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 2048 2048"
        >
          <path
            fill="currentColor"
            d="m1115 1024l690 691l-90 90l-691-690l-691 690l-90-90l690-691l-690-691l90-90l691 690l691-690l90 90l-690 691z"
          />
        </svg>
      </div>
    </div>

    <!-- fim tela cifra -->


    <div class="tela_user" id="usuario">
      <div class="container_perfil">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="150"
          height="150"
          fill="currentColor"
          class="bi bi-person-circle"
          viewBox="0 0 16 16"
          id="btn_user"
        >
          <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
          <path
            fill-rule="evenodd"
            d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"
          />
        </svg>
        <b id="b_user">Olá, user</b>
        <button class="lista_user"><h3>Músicas favoritas</h3></button>
        
      
      <div class="logout" onclick="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/>
          <path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
        </svg><b>sair</b>
      </div>
      
      </div>
      
      <div class="musicas_user" id="musicafav">
        
      </div>
      
      </div>
      
      
    </div>

    <div class="footer">
      <div class="redes_sociais">
        <div>
          <a
            href="https://instagram.com/ali_aonde?igshid=ZDdkNTZiNTM="
            target="_blank"
            ><img src="../fotos_usadas/instaLogo.png"
          /></a>
        </div>
        <div>
          <a href="facebook.com" target="_blank"
            ><img src="../fotos_usadas/faceLogo.png"
          /></a>
        </div>
        <h1>
          <a href="../index.html">CIFRAEZ</a>
        </h1>
        <div>
          <a href="github.com" target="_blank"
            ><img src="../fotos_usadas/gitLogo.png"
          /></a>
        </div>
        <div>
          <a href="Wa.me/5511975757745" target="_blank"
            ><img src="../fotos_usadas/wppLogo.png"
          /></a>
        </div>
      </div>
      <div class="direitos">
        <h6>@ Todos os direitos reservados para Arthur Silemanali - 2023</h6>
      </div>
    </div>

    <script>
      
      const tela_cifra = document.querySelector(".tela_inteira_cifra");
      const tela_user = document.querySelector(".tela_user")
      
      var artista = "";
      var musica = "";

      favoritas()
      autenticar_login()
      


      function alterar_cifra(cifras) {
        const botao_favoritar = document.getElementById("#btn_favoritar");
        var cifra_mostrar = favoritasUsuario[cifras];
        id_musica = cifra_mostrar.musica;
        id_artista = cifra_mostrar.id_artista;
        musica = cifra_mostrar.nome_da_musica;
        artista = cifra_mostrar.nome_do_artista;
        cifra = cifra_mostrar.cifra;
        musica_selecionada.innerHTML = `<div class="menu_cifra">
      <div class="nome_da_musica">
        <h4 id="h4_nome_musica">${musica} <b id="b_artista">${artista}</b></h4>
      </div>

    

      <div class="rolar_pagina">
        Auto rolagem


        <label class="switch">
          <input
            id="checkboxScroll"
            type="checkbox"
            value="0"
            onchange="opçao_rolar(this)"
          />
          <span class="slider round"></span>
        </label>
      </div>

     
      <img src="../fotos_usadas/background.jpg" />
      
    </div>
    <pre id="cifra">${cifra}</pre>
    `;
        
        tela_cifra.classList.remove("escondido");
        usuario.style.display = "none"
       
       

        autenticar_permissao();

        const svg_fav = document.getElementById("svg_fav");
        svg_fav.addEventListener("click", function () {
          svg_fav.setAttribute("fill", "red");
        });
      }

      var checkboxScroll = document.querySelector("#checkboxScroll");
      var velocidade_range = document.querySelector("#range");
      var range = document.getElementById("rolar");

      var scrollInterval;

      function opçao_rolar(element) {
        if (element.checked) {
          document.querySelector("#range").classList.remove("escondido");
        } else {
          document.querySelector("#range").classList.add("escondido");
          document.getElementById("rolar").classList.remove("escondido");

          stopScroll();
        }
      }


      var artista = "";
      var musica = "";
      let favoritasUsuario = []
      function favoritas() {
        var usuarioVar = sessionStorage.getItem("ID_USUARIO");

        console.log(usuarioVar);

        fetch(`/favoritas/${usuarioVar}`).then(function (resposta) {
          console.log("ESTOU NO THEN DO favoritas()!");
          console.log(usuarioVar);

          if (resposta.ok) {
            console.log(resposta);

            resposta.json().then((json) => {
              console.log("Resposta Traduzida", json);
              
              favoritasUsuario = json;
              for (var posicao = 0; posicao < favoritasUsuario.length; posicao++) {

                var cifraAtual = favoritasUsuario[posicao];
                artista = cifraAtual.nome_do_artista;
                musica = cifraAtual.nome_da_musica;

                    console.log(cifraAtual)

                    musicafav.innerHTML += `<div class="musica_user"  onclick="alterar_cifra(${posicao})">
                  <h3>${musica} - ${artista}</h3>
                </div>`
          }

              
            });
          }
        });
      }

      function logout (){
        sessionStorage.clear()
        window.location.href = "../index.html"
      }
      
      function autenticar_login(){
        const usuario = sessionStorage.NOME_USUARIO
        b_user.innerHTML = `Olá, ${usuario}` 
      }
      

      function exibir_pesquisa() {
        const botao_favoritar = document.getElementById("#btn_favoritar");
        var cifra_mostrar = cifraPesquisada;
        id_musica = cifra_mostrar.musica;
        id_artista = cifra_mostrar.id_artista;
        musica = cifra_mostrar.nome_da_musica;
        artista = cifra_mostrar.nome_do_artista;
        cifra = cifra_mostrar.cifra;
        musica_selecionada.innerHTML = `<div class="menu_cifra">
      <div class="nome_da_musica" >
        <h4 id="h4_nome_musica">${musica} <b id="b_artista">${artista}</b></h4>
      </div>

     

      <div class="rolar_pagina">
        Auto rolagem


        <label class="switch">
          <input
            id="checkboxScroll"
            type="checkbox"
            value="0"
            onchange="opçao_rolar(this)"
          />
          <span class="slider round"></span>
        </label>
      </div>

     
      <img src="../fotos_usadas/background.jpg" />
      
    </div>
    <pre id="cifra">${cifra}</pre>
    `;

    tela_cifra.classList.remove("escondido");
        usuario.style.display = "none"

       
  };

      function pesquisar() {
        var pesquisaVar = ipt_pesquisa.value;

        console.log(pesquisaVar);

        fetch("/pesquisa/" + pesquisaVar).then(async function (resposta) {
          console.log("ESTOU NO THEN DO pesquisa()!");
          console.log(pesquisaVar);
          //  cifraPesquisada =  await resposta.json()

          if (resposta.ok) {
            console.log(resposta);

            resposta.json().then((json) => {
              console.log("Resposta Traduzida", json);

              cifraPesquisada = json;

              exibir_pesquisa();
            });
          } else {
            console.log("Não temos essa música: ", pesquisaVar);
            alert("Infelizmente não temos essa música");

            resposta.text().then((texto) => {
              console.error(texto);
            });
          }
        });
      }

      
      function handleKeyUp(event) {
        if (event.keyCode === 13) {
          pesquisar();
        }
      }

      function correr_pagina() {
        var intervalo = parseInt(document.getElementById("rolar").value);
        var intervalo_liso = intervalo / 10;

        document.getElementById("rolar").classList.add("escondido");

        scrollInterval = setInterval(function () {
          window.scrollBy(0, 1);

          if (
            window.innerHeight + window.pageYOffset >=
            document.body.offsetHeight
          ) {
            clearInterval(scrollInterval);

            document.getElementById("rolar").value = "";

            parar_rolagem();

            document.getElementById("rolar").classList.remove("escondido");
          }
        }, intervalo_liso);
      }

      function parar_rolagem() {
        document.querySelector("#range").classList.add("escondido");
        document.getElementById("rolar").classList.remove("escondido");
        document.getElementById("checkboxScroll").checked = false;

        clearInterval(scrollInterval);
      }

    </script>
  </body>
</html>
